<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.playstamp.playreviewdetail.mybatis.IPlayReviewDetailDAO">
	<select id="getPlayReviewDetail" resultType="com.playstamp.playreviewdetail.PlayReviewDetail" parameterType="string">
		SELECT PLAYREV_CD, RATING_CD, PLAY_IMG, TITLE, PLAYREV_DT, CONTENTS, PLAY_DT, PLAY_TIME, PLAY_NM, THEATER, PLAY_CAST, COMPANION, USER_NICK, USER_CD, LCOUNT, CCOUNT
		FROM VIEW_PLAYREVDETAIL
		WHERE PLAYREV_CD=#{playrev_cd}
	</select>
	
	<select id="getCommentList" resultType="com.playstamp.playreviewdetail.Comment" parameterType="string">
		SELECT COMMENT_CD, PLAYREV_CD, WR_DT, COMMENTS, USER_NICK, USER_CD
		FROM VIEW_COMMENT
		WHERE PLAYREV_CD=#{playrev_cd}
		ORDER BY WR_DT DESC
	</select>
	
	<insert id="addComment">
		INSERT INTO TBL_COMMENT(COMMENT_CD, PLAYREV_CD, USER_CD, WR_DT, COMMENTS)
		VALUES(COMMENT_SEQ.NEXTVAL, #{playrev_cd}, #{user_cd}, SYSDATE, #{comments})
	</insert>
	
	<delete id="removeComment">
		DELETE
		FROM TBL_COMMENT
		WHERE COMMENT_CD=#{comment_cd}
	</delete>
	
	<insert id="addHeart">
		INSERT INTO TBL_LIKE(LIKE_CD, PLAYREV_CD, USER_CD, LIKE_DT)
		VALUES(LIKE_SEQ.NEXTVAL, #{playrev_cd}, #{user_cd}, SYSDATE)
	</insert>
	
	<select id="countHeart" resultType="Integer">
		SELECT LCOUNT
		FROM VIEW_HEARTCOUNT
		WHERE PLAYREV_CD=#{playrev_cd}
	</select>
	
	<select id="checkHeart" resultType="Integer">
		SELECT COUNT(*) AS CCOUNT
		FROM TBL_LIKE
		WHERE PLAYREV_CD=#{playrev_cd} AND USER_CD=#{user_cd}
	</select>
	
	<delete id="delHeart">
		DELETE
		FROM TBL_LIKE
		WHERE PLAYREV_CD=#{playrev_cd} AND USER_CD=#{user_cd}
	</delete>
	
	<select id="checkRepCom" resultType="com.playstamp.playreviewdetail.CommentBlind" parameterType="string">
		SELECT COMMENT_CD, REP_COM_CD, REP_DT, REP_COMCH_CD, REP_ST_CD
		FROM VIEW_COMMENT_BLIND
		WHERE COMMENT_CD=#{comment_cd} AND ROWNUM=1
	</select>
	
	<select id="getUserGrade" resultType="string" parameterType="string">
		SELECT GRADE
		FROM VIEW_MEMBERGRADE
		WHERE USER_ID=#{user_id}
	</select>
	
	<select id="getRatingAvg" resultType="integer" parameterType="string">
		SELECT ROUND(SUM(RATING_CD)/COUNT(*))
		FROM VIEW_RATING_AVG
		WHERE PLAY_CD=#{play_cd}
	</select>
</mapper>