<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.playstamp.review.mybatis.IAddReviewDAO">
<!-- 리뷰 등록 3단계에 필요한 메소드를 모두 포함하는 인터페이스 -->

	<!-- 검색 시 공연정보를 모두 가져오는 playList() (공연명: 기간도 추가해서 보여주기)-->
	<select id="playList" resultType="com.playstamp.review.Play">
		SELECT play_cd, theater_cd, genre_cd, mng_cd, play_nm
		     , play_start, play_end, play_img, play_cast
		FROM VIEW_PLAY
	</select>
	
	<!-- 사용자가 선택한 공연명+날짜에 해당하는 공연코드 반환 -->
	<select id="searchPlayCd" resultType="java.lang.String">
		SELECT play_cd
		FROM VIEW_PLAY
		WHERE play_nm = '${play_nm}'
	</select>
	
	<!-- 리뷰 식별코드에 insert하는 add -->
 	<insert id="addDistinctReview">		
 		INSERT INTO TBL_REV_DISTIN(REV_DISTIN_CD, USER_CD, PLAY_CD)
 		VALUES('RD' || TO_CHAR(SEQ_REV_DISTIN.NEXTVAL), '${user_cd}', '${play_cd}')
 	</insert>
 	
 	<!-- 리뷰 식별코드 가져오기 -->
 	<select id="searchRevDistinCd" resultType="java.lang.String">
 		SELECT REV_DISTIN_CD
		FROM TBL_REV_DISTIN
		WHERE PLAY_CD='${play_cd}' AND USER_CD='${user_cd}'
 	</select>
 	
 	<!-- 공연 코드로 공연 관련 모든 정보 가져오기 -->
 	<select id="searchPlay" resultType="com.playstamp.review.Play">
 		SELECT PLAY_CD, THEATER_CD, GENRE_CD, PLAY_NM
      		 , PLAY_START, PLAY_END, PLAY_IMG, PLAY_CAST
		FROM TBL_PLAY
		WHERE PLAY_CD='${play_cd}'
 	</select>
 	
 	<!-- 일반 공연장의 좌석 리뷰 테이블에 insert -->
 	<insert id="addSeatReview">	
		INSERT INTO TBL_SEAT_REV(SEAT_REV_CD, REV_DISTIN_CD
		, VIEW_RATING, SEAT_RATING, LIGHT_RATING, SOUND_RATING,
		SEAT_FLOW, SEAT_AREA, SEAT_LINE, SEAT_NUM, SEAT_REV) 
		VALUES('SR' || TO_CHAR(SEQ_SEAT_REV.NEXTVAL), '${rev_distin_cd}'
		, '${view_rating}', '${seat_rating}', '${light_rating}', '${sound_rating}',
		'${seat_flow}', '${seat_area}', '${seat_line}', '${seat_num}', '${seat_rev}')
 	</insert>
 	
 	<!-- 5대 공연장의 좌석 리뷰 테이블에 insert -->
 	<insert id="addMSeatReview">
		INSERT INTO TBL_MSEAT_REV(MSEAT_REV_CD, REV_DISTIN_CD, MSEAT_SORT_CD
		, VIEW_RATING, SEAT_RATING, LIGHT_RATING, SOUND_RATING,
		SEAT_FLOW, SEAT_AREA,	SEAT_LINE, SEAT_NUM, SEAT_REV, SEATREV_DT) 
		VALUES('MSR' || TO_CHAR(SEQ_MSEAT_REV.NEXTVAL), '${rev_distin_cd}', ${mseat_sort_cd}
		, ${view_rating}, ${seat_rating}, ${light_rating}, ${sound_rating}
		, ${seat_flow}, '${seat_area}', '${seat_line}', ${seat_num}, '${seat_rev}', SYSDATE)
 	</insert>
 	
 	
 	
</mapper>